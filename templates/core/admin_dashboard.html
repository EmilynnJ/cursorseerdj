{% extends 'base.html' %}
{% load humanize %}
{% block title %}Admin Dashboard - SoulSeer{% endblock %}
{% block content %}
<div class="max-w-6xl mx-auto px-4 py-16">
  <h1 class="font-heading text-5xl text-soulseer-pink mb-2">Admin Dashboard</h1>
  <p class="font-body text-white/60 mb-10">Platform Management</p>

  <!-- Stats -->
  <div class="grid gap-6 grid-cols-2 md:grid-cols-4 mb-12">
    <div class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50 text-center">
      <p class="text-white/60 text-xs font-body uppercase tracking-wider">Total Users</p>
      <p class="text-4xl font-bold text-white mt-2">{{ total_users }}</p>
    </div>
    <div class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50 text-center">
      <p class="text-white/60 text-xs font-body uppercase tracking-wider">Active Readers</p>
      <p class="text-4xl font-bold text-green-400 mt-2">{{ active_readers }}</p>
    </div>
    <div class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50 text-center">
      <p class="text-white/60 text-xs font-body uppercase tracking-wider">Total Sessions</p>
      <p class="text-4xl font-bold text-blue-400 mt-2">{{ total_sessions }}</p>
    </div>
    <div class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50 text-center">
      <p class="text-white/60 text-xs font-body uppercase tracking-wider">Revenue</p>
      <p class="text-4xl font-bold text-soulseer-pink mt-2">${{ total_revenue|floatformat:0 }}</p>
    </div>
  </div>

  <div class="grid gap-8 md:grid-cols-2">

    <!-- Reader Onboarding -->
    <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
      <h2 class="font-heading text-2xl text-soulseer-pink mb-4">Pending Reader Applications</h2>
      {% for reader in pending_readers %}
      <div class="py-4 border-b border-white/10 last:border-0 flex justify-between items-center font-body">
        <div>
          <p class="text-white">{{ reader.user.get_full_name|default:reader.slug }}</p>
          <p class="text-white/50 text-xs">{{ reader.created_at|date:"M d, Y" }}</p>
        </div>
        <a href="/admin/readers/readerprofile/{{ reader.pk }}/change/" class="px-3 py-1 rounded text-sm bg-soulseer-pink/20 text-soulseer-pink border border-soulseer-pink/50 hover:bg-soulseer-pink/30 transition">Review</a>
      </div>
      {% empty %}
      <p class="text-white/50 text-center py-6 font-body">No pending applications.</p>
      {% endfor %}
    </section>

    <!-- Moderation Queue -->
    <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
      <div class="flex justify-between items-center mb-4">
        <h2 class="font-heading text-2xl text-soulseer-pink">Moderation Queue</h2>
        <a href="{% url 'moderation_queue' %}" class="text-sm text-soulseer-pink/80 hover:text-soulseer-pink transition font-body">View all</a>
      </div>
      {% for flag in pending_flags %}
      <div class="py-4 border-b border-white/10 last:border-0 font-body">
        <p class="text-white text-sm">{{ flag.reason|truncatewords:15 }}</p>
        <p class="text-white/50 text-xs">By {{ flag.reporter.get_full_name|default:flag.reporter.username }}</p>
        <div class="flex gap-3 mt-2">
          <form method="post" action="{% url 'resolve_flag' flag.pk %}">{% csrf_token %}
            <button type="submit" class="text-xs text-green-400 hover:text-green-300">Resolve</button>
          </form>
          <form method="post" action="{% url 'dismiss_flag' flag.pk %}">{% csrf_token %}
            <button type="submit" class="text-xs text-red-400 hover:text-red-300">Dismiss</button>
          </form>
        </div>
      </div>
      {% empty %}
      <p class="text-white/50 text-center py-6 font-body">No pending flags.</p>
      {% endfor %}
    </section>

    <!-- Recent Refunds -->
    <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
      <div class="flex justify-between items-center mb-4">
        <h2 class="font-heading text-2xl text-soulseer-pink">Recent Refunds</h2>
        <a href="{% url 'refund_adjustment' %}" class="text-sm text-soulseer-pink/80 hover:text-soulseer-pink transition font-body">Issue Refund</a>
      </div>
      {% for entry in recent_refunds %}
      <div class="py-3 border-b border-white/10 last:border-0 flex justify-between font-body">
        <div>
          <p class="text-white text-sm">{{ entry.wallet.user.get_full_name|default:entry.wallet.user.username }}</p>
          <p class="text-white/50 text-xs">{{ entry.created_at|date:"M d, Y" }}</p>
        </div>
        <p class="text-blue-400 font-semibold">${{ entry.amount|floatformat:2 }}</p>
      </div>
      {% empty %}
      <p class="text-white/50 text-center py-6 font-body">No recent refunds.</p>
      {% endfor %}
    </section>

    <!-- Quick Admin Links -->
    <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
      <h2 class="font-heading text-2xl text-soulseer-pink mb-4">Admin Tools</h2>
      <ul class="space-y-3 font-body">
        <li><a href="/admin/" class="text-white/80 hover:text-soulseer-pink transition">Django Admin Panel</a></li>
        <li><a href="{% url 'moderation_queue' %}" class="text-white/80 hover:text-soulseer-pink transition">Moderation Queue ({{ pending_flags|length }} pending)</a></li>
        <li><a href="{% url 'refund_adjustment' %}" class="text-white/80 hover:text-soulseer-pink transition">Refunds & Adjustments</a></li>
        <li><a href="/admin/readings/session/" class="text-white/80 hover:text-soulseer-pink transition">Sessions</a></li>
        <li><a href="/admin/wallets/wallet/" class="text-white/80 hover:text-soulseer-pink transition">Wallets</a></li>
        <li><a href="/admin/readers/readerprofile/" class="text-white/80 hover:text-soulseer-pink transition">Reader Profiles</a></li>
      </ul>
    </section>
  </div>
</div>
{% endblock %}
