{% extends 'base.html' %}
{% load humanize %}
{% block title %}Client Dashboard - SoulSeer{% endblock %}
{% block content %}
<div class="max-w-6xl mx-auto px-4 py-16">
  <h1 class="font-heading text-5xl text-soulseer-pink mb-2">Your Dashboard</h1>
  <p class="font-body text-white/60 mb-10">Welcome, {{ request.user.profile.display_name|default:request.user.first_name }}</p>

  <div class="grid gap-8 md:grid-cols-3">
    <div class="md:col-span-2 space-y-8">

      <!-- Wallet -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <div class="flex justify-between items-center mb-4">
          <h2 class="font-heading text-2xl text-soulseer-pink">Wallet Balance</h2>
          <a href="{% url 'wallet_topup' %}" class="px-4 py-2 rounded bg-soulseer-pink/20 text-soulseer-pink border border-soulseer-pink hover:bg-soulseer-pink/30 transition text-sm font-body">+ Add Funds</a>
        </div>
        <p class="text-4xl text-white font-bold">${{ wallet.balance|floatformat:2 }}</p>
        <p class="text-white/60 mt-2 text-sm font-body">Total spent: ${{ total_spent|floatformat:2 }}</p>
      </section>

      <!-- Recent Transactions -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <div class="flex justify-between items-center mb-4">
          <h2 class="font-heading text-2xl text-soulseer-pink">Recent Transactions</h2>
          <a href="{% url 'wallet_dashboard' %}" class="text-sm text-soulseer-pink/80 hover:text-soulseer-pink transition font-body">View all</a>
        </div>
        {% for entry in recent_entries %}
        <div class="flex justify-between py-3 border-b border-white/10 last:border-0 font-body">
          <div>
            <p class="text-white">{{ entry.get_entry_type_display }}</p>
            <p class="text-white/50 text-xs">{{ entry.created_at|date:"M d, Y H:i" }}</p>
          </div>
          <p class="font-semibold {% if entry.amount > 0 %}text-green-400{% else %}text-red-400{% endif %}">
            {% if entry.amount > 0 %}+{% endif %}${{ entry.amount|floatformat:2 }}
          </p>
        </div>
        {% empty %}
        <p class="text-white/50 text-center py-6 font-body">No transactions yet.</p>
        {% endfor %}
      </section>

      <!-- Upcoming Bookings -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <h2 class="font-heading text-2xl text-soulseer-pink mb-4">Upcoming Sessions</h2>
        {% for booking in upcoming_bookings %}
        <div class="py-4 border-b border-white/10 last:border-0 font-body">
          <p class="text-white font-semibold">{{ booking.slot.start|date:"M d, Y \a\t H:i" }}</p>
          <p class="text-white/60 text-sm">{{ booking.slot.duration_minutes }} minutes • ${{ booking.amount|floatformat:2 }}</p>
        </div>
        {% empty %}
        <p class="text-white/50 text-center py-6 font-body">No upcoming sessions.
          <a href="{% url 'schedule' %}" class="text-soulseer-pink hover:underline">Book one now</a>
        </p>
        {% endfor %}
      </section>

      <!-- Past Sessions -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <h2 class="font-heading text-2xl text-soulseer-pink mb-4">Past Sessions</h2>
        {% for session in past_sessions %}
        <div class="py-4 border-b border-white/10 last:border-0 font-body">
          <a href="{% url 'session_detail' session.pk %}" class="text-white hover:text-soulseer-pink transition">
            Session #{{ session.pk }} — {{ session.modality|title }} — {{ session.billing_minutes }} min
          </a>
          <p class="text-white/50 text-xs">{{ session.ended_at|date:"M d, Y" }}</p>
        </div>
        {% empty %}
        <p class="text-white/50 text-center py-6 font-body">No past sessions yet.</p>
        {% endfor %}
      </section>

      <!-- Notes -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <h2 class="font-heading text-2xl text-soulseer-pink mb-4">My Notes</h2>
        {% for n in notes %}
        <p class="text-white/80 font-body py-2 border-b border-white/10 last:border-0">{{ n.body|truncatewords:30 }}</p>
        {% empty %}
        <p class="text-white/50 text-center py-6 font-body">No notes yet.</p>
        {% endfor %}
      </section>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <h3 class="font-heading text-xl text-soulseer-pink mb-4">Favorite Readers</h3>
        {% for fav in favorites %}
        <a href="{% url 'reader_profile' fav.reader.slug %}" class="flex items-center gap-3 py-3 border-b border-white/10 last:border-0 hover:text-soulseer-pink transition">
          <div class="w-10 h-10 rounded-full bg-soulseer-pink/20 flex items-center justify-center text-soulseer-pink font-heading text-xl">{{ fav.reader.slug|slice:":1"|upper }}</div>
          <span class="font-body text-white">{{ fav.reader.user.get_full_name|default:fav.reader.slug }}</span>
        </a>
        {% empty %}
        <p class="text-white/50 text-center py-4 font-body text-sm">No favorites yet.</p>
        {% endfor %}
      </section>

      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50 font-body">
        <h3 class="font-heading text-xl text-soulseer-pink mb-4">Quick Links</h3>
        <ul class="space-y-3">
          <li><a href="{% url 'reader_list' %}" class="text-white/80 hover:text-soulseer-pink transition">Find a Reader</a></li>
          <li><a href="{% url 'schedule' %}" class="text-white/80 hover:text-soulseer-pink transition">Book a Session</a></li>
          <li><a href="{% url 'messages_inbox' %}" class="text-white/80 hover:text-soulseer-pink transition">Messages</a></li>
          <li><a href="{% url 'wallet_dashboard' %}" class="text-white/80 hover:text-soulseer-pink transition">Wallet</a></li>
          <li><a href="{% url 'profile_edit' %}" class="text-white/80 hover:text-soulseer-pink transition">Edit Profile</a></li>
          <li><a href="{% url 'data_export' %}" class="text-white/80 hover:text-soulseer-pink transition">Export My Data</a></li>
        </ul>
      </section>
    </div>
  </div>
</div>
{% endblock %}
