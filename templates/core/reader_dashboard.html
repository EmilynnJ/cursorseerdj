{% extends 'base.html' %}
{% load humanize %}
{% block title %}Reader Dashboard - SoulSeer{% endblock %}
{% block content %}
<div class="max-w-6xl mx-auto px-4 py-16">
  <h1 class="font-heading text-5xl text-soulseer-pink mb-2">Reader Dashboard</h1>
  <p class="font-body text-white/60 mb-10">{{ request.user.profile.display_name|default:request.user.first_name }}</p>

  <div class="grid gap-8 md:grid-cols-3">
    <div class="md:col-span-2 space-y-8">

      <!-- Earnings -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <h2 class="font-heading text-2xl text-soulseer-pink mb-6">Earnings</h2>
        <div class="grid gap-4 grid-cols-3">
          <div class="text-center">
            <p class="text-white/60 text-xs font-body uppercase tracking-wider">Session</p>
            <p class="text-2xl font-bold text-green-400">${{ session_earnings|floatformat:2 }}</p>
          </div>
          <div class="text-center">
            <p class="text-white/60 text-xs font-body uppercase tracking-wider">Gifts</p>
            <p class="text-2xl font-bold text-blue-400">${{ gift_earnings|floatformat:2 }}</p>
          </div>
          <div class="text-center">
            <p class="text-white/60 text-xs font-body uppercase tracking-wider">Total</p>
            <p class="text-2xl font-bold text-soulseer-pink">${{ total_earnings|floatformat:2 }}</p>
          </div>
        </div>
      </section>

      <!-- Session History -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <h2 class="font-heading text-2xl text-soulseer-pink mb-4">Recent Sessions</h2>
        {% for session in sessions %}
        <div class="py-4 border-b border-white/10 last:border-0 font-body">
          <a href="{% url 'session_detail' session.pk %}" class="flex justify-between hover:text-soulseer-pink transition">
            <div>
              <p class="text-white">{{ session.client.get_full_name|default:session.client.username }}</p>
              <p class="text-white/50 text-xs">{{ session.modality|title }} • {{ session.billing_minutes }} min • {{ session.started_at|date:"M d, Y" }}</p>
            </div>
            <p class="text-green-400 font-semibold">${{ session.rate_per_minute|floatformat:2 }}/min</p>
          </a>
        </div>
        {% empty %}
        <p class="text-white/50 text-center py-6 font-body">No sessions yet.</p>
        {% endfor %}
      </section>

      <!-- Rates -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <div class="flex justify-between items-center mb-4">
          <h2 class="font-heading text-2xl text-soulseer-pink">My Rates</h2>
          <a href="{% url 'reader_rates' %}" class="text-sm text-soulseer-pink/80 hover:text-soulseer-pink transition font-body">Edit Rates</a>
        </div>
        <div class="grid grid-cols-3 gap-4 font-body">
          {% for rate in rates %}
          <div class="p-4 rounded border border-soulseer-pink/20 text-center">
            <p class="text-white/60 text-xs uppercase tracking-wider">{{ rate.modality|title }}</p>
            <p class="text-xl font-bold text-white mt-1">${{ rate.rate_per_minute }}/min</p>
          </div>
          {% empty %}
          <p class="text-white/50 col-span-3 text-center py-4">No rates set. <a href="{% url 'reader_rates' %}" class="text-soulseer-pink">Set them now</a></p>
          {% endfor %}
        </div>
      </section>

      <!-- Availability -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <div class="flex justify-between items-center mb-4">
          <h2 class="font-heading text-2xl text-soulseer-pink">Availability</h2>
          <a href="{% url 'reader_availability' %}" class="text-sm text-soulseer-pink/80 hover:text-soulseer-pink transition font-body">Edit</a>
        </div>
        {% with days="Mon,Tue,Wed,Thu,Fri,Sat,Sun" %}
        {% for slot in availability %}
        <div class="py-3 border-b border-white/10 last:border-0 flex justify-between font-body">
          <p class="text-white">{{ slot.get_day_of_week_display|default:slot.day_of_week }}</p>
          <p class="text-white/70">{{ slot.start_time|time:"H:i" }} – {{ slot.end_time|time:"H:i" }}</p>
        </div>
        {% empty %}
        <p class="text-white/50 text-center py-4 font-body">No availability set. <a href="{% url 'reader_availability' %}" class="text-soulseer-pink">Set it now</a></p>
        {% endfor %}
        {% endwith %}
      </section>

      <!-- Upcoming Bookings -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <h2 class="font-heading text-2xl text-soulseer-pink mb-4">Upcoming Bookings</h2>
        {% for booking in upcoming_bookings %}
        <div class="py-4 border-b border-white/10 last:border-0 font-body">
          <p class="text-white">{{ booking.slot.start|date:"M d, Y \a\t H:i" }}</p>
          <p class="text-white/60 text-sm">{{ booking.slot.duration_minutes }} minutes</p>
        </div>
        {% empty %}
        <p class="text-white/50 text-center py-6 font-body">No upcoming bookings.</p>
        {% endfor %}
      </section>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Rating -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50 text-center">
        <h3 class="font-heading text-xl text-soulseer-pink mb-2">Rating</h3>
        <p class="text-5xl font-bold text-soulseer-gold">{{ avg_rating|floatformat:1|default:"—" }}</p>
        <p class="text-white/50 text-sm font-body mt-2">{{ review_count }} review{{ review_count|pluralize }}</p>
      </section>

      <!-- Reviews -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50">
        <h3 class="font-heading text-xl text-soulseer-pink mb-4">Recent Reviews</h3>
        {% for rev in reviews %}
        <div class="py-3 border-b border-white/10 last:border-0 font-body">
          <div class="flex justify-between text-sm">
            <p class="text-white">{{ rev.client.get_full_name|default:"Client" }}</p>
            <p class="text-soulseer-gold">{{ rev.rating }}★</p>
          </div>
          {% if rev.body %}<p class="text-white/60 text-xs mt-1">{{ rev.body|truncatewords:15 }}</p>{% endif %}
        </div>
        {% empty %}
        <p class="text-white/50 text-center py-4 font-body text-sm">No reviews yet.</p>
        {% endfor %}
      </section>

      <!-- Quick Links -->
      <section class="p-6 rounded-lg border border-soulseer-pink/30 bg-soulseer-darker/50 font-body">
        <h3 class="font-heading text-xl text-soulseer-pink mb-4">Quick Links</h3>
        <ul class="space-y-3">
          <li><a href="{% url 'reader_rates' %}" class="text-white/80 hover:text-soulseer-pink transition">Manage Rates</a></li>
          <li><a href="{% url 'reader_availability' %}" class="text-white/80 hover:text-soulseer-pink transition">Set Availability</a></li>
          <li><a href="{% url 'messages_inbox' %}" class="text-white/80 hover:text-soulseer-pink transition">Messages</a></li>
          <li><a href="{% url 'live_list' %}" class="text-white/80 hover:text-soulseer-pink transition">Go Live</a></li>
          <li><a href="{% url 'profile_edit' %}" class="text-white/80 hover:text-soulseer-pink transition">Edit Profile</a></li>
        </ul>
      </section>
    </div>
  </div>
</div>
{% endblock %}
