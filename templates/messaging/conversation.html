{% extends 'base.html' %}
{% load humanize %}
{% block title %}Conversation - SoulSeer{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto px-4 py-16">
  <h1 class="font-heading text-5xl text-soulseer-pink mb-8">Messages</h1>
  <a href="{% url 'messages_inbox' %}" class="text-soulseer-pink/80 hover:text-soulseer-pink">← Back to inbox</a>
  <div class="mt-6 p-6 rounded border border-soulseer-pink/30 bg-soulseer-darker/50">
    <p class="text-white/70">With {{ conversation.client.get_full_name|default:conversation.client }} / {{ conversation.reader.get_full_name|default:conversation.reader }}</p>
    <div class="mt-6 space-y-4 max-h-96 overflow-y-auto">
      {% for m in messages %}
      <div class="{% if m.sender == request.user %}ml-8 text-right{% else %}mr-8{% endif %}">
        <p class="text-sm text-white/60">{{ m.sender.get_full_name|default:m.sender.username }} · {{ m.created_at|date:"M d H:i" }}{% if m.is_paid_reply %} · Paid{% endif %}</p>
        <p class="font-body text-white/90">{{ m.body }}</p>
      </div>
      {% endfor %}
    </div>
    <form method="post" action="{% url 'send_message' conversation.pk %}" class="mt-6 flex gap-2">
      {% csrf_token %}
      <input type="text" name="body" placeholder="Type a message..." class="flex-1 bg-soulseer-darker border border-soulseer-pink/50 rounded px-4 py-2 text-white" required>
      {% if user == conversation.reader %}
      <label class="flex items-center text-white/80"><input type="checkbox" name="is_paid" value="1"> Paid reply</label>
      {% endif %}
      <button type="submit" class="px-4 py-2 rounded bg-soulseer-pink/20 text-soulseer-pink border border-soulseer-pink hover:bg-soulseer-pink/30 transition">Send</button>
    </form>
  </div>
</div>
{% endblock %}
